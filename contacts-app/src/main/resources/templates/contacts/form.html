<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Contact form · Contacts Manager</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body class="page-root">

<div class="app-header">
    <div class="app-header-inner">
        <div class="app-title">
            Contacts <span>Manager</span>
        </div>
        <div class="app-header-actions">
            <span>Contacts CRUD · Spring Boot</span>

            <a th:href="@{/users}" class="btn btn-secondary"
               sec:authorize="hasRole('ADMIN')"
               style="margin-left: 0.75rem;">
                Manage users
            </a>

            <span sec:authorize="isAuthenticated()" style="margin-left: 0.5rem;">
                · Logged in as <strong sec:authentication="name"></strong>
            </span>

            <form th:action="@{/logout}" method="post" style="display:inline;">
                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}"/>

                <button type="submit" class="btn btn-ghost">
                    Logout
                </button>
            </form>
        </div>
    </div>
</div>

<main class="app-main">
    <div class="card">

        <div class="card-header">
            <div>
                <h1 class="card-title"
                    th:text="${contact.id == null} ? 'New contact' : 'Edit contact'">
                    Contact
                </h1>
                <div class="card-subtitle"
                     th:text="${contact.id == null} ? 'Create a new contact.' : 'Update this contact.'">
                    Contact form
                </div>
            </div>
            <div class="btn-row">
                <a th:href="@{/contacts}" class="btn btn-ghost">← Back to list</a>
            </div>
        </div>

        <!-- Global errors -->
        <div th:if="${#fields.hasAnyErrors()}" class="alert alert-danger">
            Please correct the errors below.
        </div>

        <form th:action="@{/contacts/save}" th:object="${contact}" method="post">

            <!-- CSRF -->
            <input type="hidden"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}"/>

            <!-- ID (for edit) -->
            <input type="hidden" th:if="*{id != null}" th:field="*{id}"/>

            <!-- Basic info -->
            <section class="form-section">
                <h2 class="form-section-title">Basic information</h2>
                <div class="form-grid">

                    <div class="form-field">
                        <label class="form-label">Title</label>
                        <input type="text" th:field="*{title}" class="form-control">
                        <div class="field-error" th:errors="*{title}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">First name</label>
                        <input type="text" th:field="*{firstName}" class="form-control">
                        <div class="field-error" th:errors="*{firstName}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Last name</label>
                        <input type="text" th:field="*{lastName}" class="form-control">
                        <div class="field-error" th:errors="*{lastName}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Gender</label>
                        <input type="text" th:field="*{gender}" class="form-control">
                        <div class="field-error" th:errors="*{gender}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Group</label>
                        <input type="text" th:field="*{persGroup}" class="form-control">
                        <div class="field-error" th:errors="*{persGroup}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Function</label>
                        <input type="text" th:field="*{function}" class="form-control">
                        <div class="field-error" th:errors="*{function}"></div>
                    </div>

                </div>
            </section>

            <!-- Contact details -->
            <section class="form-section">
                <h2 class="form-section-title">Contact details</h2>
                <div class="form-grid">

                    <div class="form-field">
                        <label class="form-label">Email</label>
                        <input type="email" th:field="*{email}" class="form-control">
                        <div class="field-error" th:errors="*{email}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Phone 1</label>
                        <input type="text" th:field="*{phone1}" class="form-control">
                        <div class="field-error" th:errors="*{phone1}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Phone 2</label>
                        <input type="text" th:field="*{phone2}" class="form-control">
                        <div class="field-error" th:errors="*{phone2}"></div>
                    </div>

                    <div class="form-field form-field-full">
                        <label class="form-label">Post address</label>
                        <input type="text" th:field="*{postAddress}" class="form-control">
                        <div class="field-error" th:errors="*{postAddress}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Country</label>
                        <input type="text" th:field="*{country}" class="form-control">
                        <div class="field-error" th:errors="*{country}"></div>
                    </div>

                </div>
            </section>

            <!-- Institution & academic -->
            <section class="form-section">
                <h2 class="form-section-title">Institution & academic</h2>
                <div class="form-grid">

                    <div class="form-field form-field-full">
                        <label class="form-label">Institution</label>
                        <input type="text" th:field="*{institution}" class="form-control">
                        <div class="field-error" th:errors="*{institution}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Faculty</label>
                        <input type="text" th:field="*{faculty}" class="form-control">
                        <div class="field-error" th:errors="*{faculty}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Study domain</label>
                        <input type="text" th:field="*{studyDomain}" class="form-control">
                        <div class="field-error" th:errors="*{studyDomain}"></div>
                    </div>

                </div>
            </section>

            <!-- Additional details -->
            <section class="form-section">
                <h2 class="form-section-title">Additional details</h2>
                <div class="form-grid">

                    <div class="form-field">
                        <label class="form-label">Interest</label>
                        <input type="text" th:field="*{interest}" class="form-control">
                        <div class="field-error" th:errors="*{interest}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Fund use</label>
                        <input type="text" th:field="*{fundUse}" class="form-control">
                        <div class="field-error" th:errors="*{fundUse}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Past event</label>
                        <input type="text" th:field="*{pastEvent}" class="form-control">
                        <div class="field-error" th:errors="*{pastEvent}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Contact person</label>
                        <input type="text" th:field="*{contactPerson}" class="form-control">
                        <div class="field-error" th:errors="*{contactPerson}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">COIL experience</label>
                        <div class="form-checkbox-row">
                            <label>
                                <input type="checkbox" th:field="*{coilExp}">
                                Has COIL experience
                            </label>
                        </div>
                        <div class="field-error" th:errors="*{coilExp}"></div>
                    </div>

                    <div class="form-field">
                        <label class="form-label">Mobility funding</label>
                        <div class="form-checkbox-row">
                            <label>
                                <input type="checkbox" th:field="*{mobilityFin}">
                                Has mobility funding
                            </label>
                        </div>
                        <div class="field-error" th:errors="*{mobilityFin}"></div>
                    </div>

                    <div class="form-field form-field-full">
                        <label class="form-label">Comments</label>
                        <textarea th:field="*{comments}" class="form-control" rows="4"></textarea>
                        <div class="field-error" th:errors="*{comments}"></div>
                    </div>

                </div>
            </section>

            <!-- Audit (read-only, only for existing contacts) -->
            <section class="form-section" th:if="*{id} != null">
                <h2 class="form-section-title">Audit</h2>
                <div class="detail-grid">

                    <div class="detail-item">
                        <div class="detail-label">Created at</div>
                        <div class="detail-value"
                             th:text="*{createdAt != null} ? ${#temporals.format(createdAt, 'yyyy-MM-dd HH:mm')} : ''">
                            2025-01-01 10:00
                        </div>
                    </div>

                    <div class="detail-item">
                        <div class="detail-label">Created by</div>
                        <div class="detail-value" th:text="*{createdBy}">user</div>
                    </div>

                    <div class="detail-item">
                        <div class="detail-label">Updated at</div>
                        <div class="detail-value"
                             th:text="*{updatedAt != null} ? ${#temporals.format(updatedAt, 'yyyy-MM-dd HH:mm')} : ''">
                            2025-01-02 11:00
                        </div>
                    </div>

                    <div class="detail-item">
                        <div class="detail-label">Updated by</div>
                        <div class="detail-value" th:text="*{updatedBy}">user</div>
                    </div>

                </div>
            </section>

            <!-- Footer / buttons -->
            <div class="form-footer">
                <span class="text-muted">
                    Fields marked with * are required.
                </span>
                <div class="form-footer-right">
                    <a th:href="@{/contacts}" class="btn btn-ghost">Cancel</a>
                    <button type="submit" class="btn btn-primary">
                        Save
                    </button>
                </div>
            </div>

        </form>

    </div>
</main>

</body>
</html>
